<html>

<head>
    <meta charset="UTF-8">
    <title>Docs</title>

    <link rel="stylesheet" href="editor.md/css/editormd.min.css" />
    <link rel="stylesheet" href="editormd/css/editormd.preview.css" />

    <!--引入js文件-->
    <!-- 开发环境版本，包含了有帮助的命令行警告 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- 生产环境版本，优化了尺寸和速度 -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
    <script src="js/jquery.min.js"></script>
    <script src="editor.md/editormd.js"></script>
    <script src="editor.md/lib/marked.min.js"></script>
    <script src="editor.md/lib/prettify.min.js"></script>
    <script src="editor.md/lib/raphael.min.js"></script>
    <script src="editor.md/lib/underscore.min.js"></script>
    <script src="editor.md/lib/sequence-diagram.min.js"></script>
    <script src="editor.md/lib/flowchart.min.js"></script>
    <script src="editor.md/lib/jquery.flowchart.min.js"></script>
    <style>
        .mdWindow {
            width: 900px;
            height: 900px;
            float: right;
            border: 8px solid gray;
            background-color: white;
            padding: 8px;
            margin: 8px;
        }

        .sidebar {
            border-right: 1px solid #f0f2f1;
            width: 180px;
            float: left;
            padding-left: 35px;
        }

        .sidebar>ul {

            font-family: "Source Sans Pro", "Helvetica Neue", Arial, sans-serif;
            font-size: 20px;
            text-align: center;
            display: inline-block;
            color: #423636;
            width: 210px;
            border: 5px solid gray;
            background-color: whitesmoke;
            padding: 5px;
            margin: 5px;
            /* list-style: none;
            padding: 0;
            margin: 0; */
        }

        .sidebar>ul>li {
            font-family: "Source Sans Pro", "Helvetica Neue", Arial, sans-serif;
            font-size: 13px;
            color: #423636;
            width: 155px;
            height: 18px;
            border: 8px solid gray;
            background-color: whitesmoke;
            padding: 10px;
            margin: 12px;
            list-style-type: none;
            /* font-size: 18px;
            font-weight: 400;
            padding: 0010px;
            margin-top: 5px; */
        }
    </style>
</head>

<body>
    <!-- [if lt IE 9]><div class="notice chromeframe">您的浏览器版本<strong>很旧很旧</strong>，为了正常地访问网站，请升级您的浏览器 <a target="_blank" href="http://browsehappy.com">立即升级</a></div><![endif] -->

    <div id="tools-div">
        <div style="float: left;" class="sidebar" :style="{'width':toolCatWidth,'height':toolCatHeight }">
            <ul>Category
                <tool-item v-for="item in Category" :tool="item" :key="item.id">
                </tool-item>
            </ul>

            <ul>Resource
                <tool-item v-for="item in Resource" :tool="item" :key="item.id">
                </tool-item>
            </ul>
        </div>
        <div id="md-to-html" class='mdWindow' :style="{ 'width':toolWindowWidth,'height':toolWindowHeight }">
            <!-- Server-side output Markdown text -->
            <textarea id='md-content' style="display:none;">### Hello world!</textarea>
        </div>
    </div>




    <script type="text/javascript">
        $.extend({
            getUrlVars: function () {
                var vars = [], hash;
                var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
                for (var i = 0; i < hashes.length; i++) {
                    hash = hashes[i].split('=');
                    vars.push(hash[0]);
                    vars[hash[0]] = hash[1];
                }
                return vars;
            },
            getUrlVar: function (name) {
                return $.getUrlVars()[name];
            }
        });

        $(function () {
            // Getting URL var by its nam
            var path ='/csnotes' +$.getUrlVar('path');
            // var path=escape(path).replace(/\+/g, '%2B').replace(/\"/g,'%22').replace(/\'/g, '%27').replace(/\//g,'%2F');
            var mdContent = "";
            var xhr = new XMLHttpRequest();
            xhr.open('get', path);
            xhr.send('')
            xhr.onload = function () {
                console.log('path:' + path);
                mdContent += xhr.responseText;
                console.log(mdContent);

                mdContent = mdContent.replace(/\[(.*)\]\((\/.*)\)/g,"[$1](/csnotes/html/docs.html?path=/csnotes/$2)");//链接格式修正

                $('#md-content').val(mdContent);
                console.log($('#md-content').val());
                editormd.markdownToHTML("md-to-html", {
                    htmlDecode: "style,script,iframe", //可以过滤标签解码
                    emoji: true,
                    taskList: true,
                    tex: true,               // 默认不解析
                    flowChart: true,         // 默认不解析
                    sequenceDiagram: true,  // 默认不解析
                });

            }

        });

        Vue.component('tool-item', {
            props: ['tool'],
            template: '<li @click="tool.method">{{ tool.content }}</li>'
        })
        var toolsApp = new Vue({
            el: '#tools-div',
            data() {
                return {
                    toolUrl: '',
                    toolWindowWidth: window.innerWidth - 350 + 'px',
                    toolWindowHeight: window.innerHeight - 100 + 'px',
                    toolCatWidth: '270px',
                    toolCatHeight: window.innerHeight - 100 + 'px',
                    Category: [{
                        id: 0,
                        content: 'Hardware',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/hw/SUMMARY.md';
                            // window.open("FormatterTools/SQLFormatter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 1,
                        content: 'OperationSystem',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/os/SUMMARY.md';
                            // window.open("FormatterTools/JsonFormatter.html"); //,'_self'                      
                        }
                    },{
                        id: 2,
                        content: 'DataStructure',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/ds/SUMMARY.md';
                            // window.open("FormatterTools/JsonFormatter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 3,
                        content: 'Tools',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/tools/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 4,
                        content: 'DataBase',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/db/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id:5,
                        content: 'C',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/c/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 6,
                        content: '.Net',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/dotnet/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 7,
                        content: 'Java',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/java/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id:8,
                        content: 'Go',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/go/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 9,
                        content: 'Python',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/py/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id:10,
                        content: 'Moblie',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/moblie/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id:11,
                        content: 'Web',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/web/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id:12,
                        content: 'FrontEnd',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/fe/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    },
                    {
                        id: 13,
                        content: 'Dev',
                        method: function () {
                             toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/dev/SUMMARY.md';
                            // window.open("FormatterTools/JsonYamlConverter.html"); //,'_self'                      
                        }
                    }],
                    Resource: [{
                        id: 0,
                        content: 'Common Res',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/res/通用资源链接.md';
                            // window.open("http://www.bejson.com/ui/compress_img/");
                        }
                    }, {
                        id: 1,
                        content: 'IT Res',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/res/IT资源链接.md';
                            // window.open("http://tool.oschina.net/");
                        }
                    }, {
                        id: 2,
                        content: 'IT Skills Tree',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/java/IT技能树.md';
                            // window.open("http://www.wapadd.cn/icons/awesome/index.htm");
                        }
                    }, {
                        id: 3,
                        content: 'RSS Sites',
                        method: function () {
                            toolsApp.toolUrl = '/csnotes/html/docs.html?path=/csnotes/java/RSS_sites.md';
                            // window.open("https://www.materialpalette.com/icons");
                        }
                    }]
                }
            },

            mounted() {
                const _this = this;
                window.onresize = () => {
                    return (() => {
                        _this.toolWindowHeight = window.innerHeight - 100 + 'px';
                        _this.toolWindowWidth = window.innerWidth - 350 + 'px';
                        console.log(_this.toolWindowHeight + '*' + _this.toolWindowWidth);
                        _this.toolCatHeight = window.innerHeight - 100 + 'px';
                        _this.toolCatWidth = '270px';
                    })()
                }
            },

        })

    </script>
</body>
</html>